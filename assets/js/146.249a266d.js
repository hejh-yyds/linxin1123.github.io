(window.webpackJsonp=window.webpackJsonp||[]).push([[146],{469:function(s,t,n){"use strict";n.r(t);var a=n(3),e=Object(a.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h2",{attrs:{id:"vue虚拟dom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#vue虚拟dom"}},[s._v("#")]),s._v(" Vue虚拟DOM")]),s._v(" "),t("h3",{attrs:{id:"_1-虚拟dom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-虚拟dom"}},[s._v("#")]),s._v(" 1. 虚拟dom")]),s._v(" "),t("p",[t("strong",[s._v("什么是虚拟dom")])]),s._v(" "),t("ul",[t("li",[s._v("普通的JS对象描述DOM对象")])]),s._v(" "),t("p",[t("strong",[s._v("虚拟DOM为何出现")])]),s._v(" "),t("ul",[t("li",[s._v("手动操作DOM麻烦且减低性能")]),s._v(" "),t("li",[s._v("可以跟踪状态的改变更新视图")])]),s._v(" "),t("p",[t("strong",[s._v("虚拟DOM的作用")])]),s._v(" "),t("ul",[t("li",[s._v("维护视图与状态的关系")]),s._v(" "),t("li",[s._v("复杂视图下提升渲染性能")])]),s._v(" "),t("h3",{attrs:{id:"_2-snabbdom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-snabbdom"}},[s._v("#")]),s._v(" 2. SnabbDom")]),s._v(" "),t("h4",{attrs:{id:"_4-1-创建项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-创建项目"}},[s._v("#")]),s._v(" 4.1 创建项目")]),s._v(" "),t("p",[s._v("在讲解"),t("code",[s._v("Snabbdom")]),s._v("的基本使用之前，我们先来创建一个项目。")]),s._v(" "),t("p",[s._v("打包工具为了方便使用，使用了"),t("code",[s._v("parcel")]),s._v(",你也可以使用"),t("code",[s._v("webpack")]),s._v(".")]),s._v(" "),t("p",[s._v("下面创建项目，并安装"),t("code",[s._v("parcel")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建项目目录")]),s._v("\nmd snabbdom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 进入项目目录")]),s._v("\n cd snabbdom"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("demo\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 创建package.json")]),s._v("\nnpm init "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("y\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//本地安装parcel")]),s._v("\nnpm install parcel"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bundler\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("配置"),t("code",[s._v("package.json")]),s._v("中的"),t("code",[s._v("scripts")]),s._v("'")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[s._v(" "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"srcipts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v('"dev"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parcel index.html --open"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//open打开浏览器")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"build"')]),s._v("："),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"parcel build index.html"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("创建目录结构")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("index.html\npackage.json\n---src\n    basicusage.js\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h4",{attrs:{id:"_4-2-导入snabbdom"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-导入snabbdom"}},[s._v("#")]),s._v(" 4.2  导入Snabbdom")]),s._v(" "),t("p",[s._v("方法文档：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("https://github.com/snabbdom/snabbdom\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("下面先安装"),t("code",[s._v("Snabbdom")]),s._v(".(这里最新版本有问题，可以先安装0.7.4)")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm install snabbdom@0.7.4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在项目的"),t("code",[s._v("js")]),s._v("文件夹下的"),t("code",[s._v("01- basicusage.js")]),s._v("文件中，添加如下代码：")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v("  snabbdom  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"snabbdom"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("snabbdom"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("以上代码的意思就是导入"),t("code",[s._v("snabbdom")]),s._v("这个包，然后打印其内容。")]),s._v(" "),t("p",[s._v("项目的启动")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("npm run dev\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这时，开启的端口号为"),t("code",[s._v("1234")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("http://localhost:1234\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("在打开的浏览器中，查看控制台的输出，发现输出的内容为"),t("code",[s._v("undefined")])]),s._v(" "),t("p",[s._v("为什么输出的是"),t("code",[s._v("undefined")]),s._v("呢?")]),s._v(" "),t("p",[s._v("这里我们需要查看对应的源码，")]),s._v(" "),t("p",[s._v("在"),t("code",[s._v("node_modules/snabbdom/snabbdom.js")]),s._v("文件中，")]),s._v(" "),t("p",[s._v("我们可以看到在整个文件中，并没有使用"),t("code",[s._v("export default")]),s._v("的方式进行导出，所以就不能使用"),t("code",[s._v("import snabbdom")]),s._v("这种方式进行导入。同时在，源码中，我们可以看到导出了三项内容分别为"),t("code",[s._v("h")]),s._v(","),t("code",[s._v("thunk")]),s._v(","),t("code",[s._v("init")]),s._v(".")]),s._v(" "),t("p",[s._v("所以，导入的代码修改成如下的形式")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" thunk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" init "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"snabbdom"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" thunk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[t("code",[s._v("Snabbdom")]),s._v("的核心仅提供最基本的功能，只导出了三个函数"),t("code",[s._v("init()")]),s._v(","),t("code",[s._v("h( )")]),s._v(","),t("code",[s._v("thunk( )")])]),s._v(" "),t("p",[t("code",[s._v("init")]),s._v("函数是高阶函数，返回"),t("code",[s._v("patch( )")]),s._v("，一会在看该方法")]),s._v(" "),t("p",[t("code",[s._v("h")]),s._v("函数返回虚拟节点"),t("code",[s._v("VNode")]),s._v(",这个函数我们在使用"),t("code",[s._v("Vue.js")]),s._v("的时候见过。")]),s._v(" "),t("p",[t("code",[s._v("h()")]),s._v("函数用于创建虚拟"),t("code",[s._v("DOM")]),s._v("，在"),t("code",[s._v("Snabbdom")]),s._v("中用"),t("code",[s._v("VNode")]),s._v("描述虚拟节点，也就是虚拟"),t("code",[s._v("DOM")]),s._v("。")]),s._v(" "),t("div",{staticClass:"language-vue line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-vue"}},[t("code",[s._v("new Vue({\nrouter,\nrender:h=>h(App)\n}).$mount('#app')\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("code",[s._v("thunk")]),s._v("函数是一种优化策略，可以在处理不可变数据时使用（用于优化复杂的视图）。")]),s._v(" "),t("h3",{attrs:{id:"_2-3-snabbdom基本使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-snabbdom基本使用"}},[s._v("#")]),s._v(" 2.3 snabbdom基本使用")]),s._v(" "),t("ul",[t("li",[s._v("基本使用(basicusage.js)")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("thunk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"snabbdom"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// console.log(init,thunk,h);")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// h函数用于构建一个虚拟dom，")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// init函数为一个高阶函数,返回函数patch：新旧DOM比对并更新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// thunk 复杂视图的优化")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" vnode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"div#conatiner.box"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hello world"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 参数数组为模块数组，如class，style，eventListener 等6个模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" patch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 获取页面id为app的元素")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#app"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 替换更新")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" newvNode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("vnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br")])]),t("ul",[t("li",[s._v("创建一个注释节点")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" a "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("oldVnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" vnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("a"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"!"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//第二个参数，表示创建一个注释节点。")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("创建子节点")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模拟请求更新dom，创建带子节点的vnode")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'snabbdom'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" patch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第二个参数可以是数组，代表子节点数组")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" vnode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"div"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"span"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这是一个span标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这是一个p标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#app"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("vnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 模拟请求")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setTimeout")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" newNode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"div"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"span"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"span标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("vnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("newNode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("hr"),s._v(" "),t("p",[t("strong",[s._v("模块使用")])]),s._v(" "),t("p",[t("strong",[s._v("常用模块")])]),s._v(" "),t("p",[s._v("官方提供了6个模块")]),s._v(" "),t("p",[t("code",[s._v("attributes:")]),s._v("设置"),t("code",[s._v("DOM")]),s._v("元素的属性，内部使用"),t("code",[s._v("setAttribute()来设置属性,")]),s._v("处理布尔类型的属性（可以对布尔类型的属性作相应的判断处理，布尔类型的属性，我们比较熟悉的有"),t("code",[s._v("selected")]),s._v(","),t("code",[s._v("checked")]),s._v("等）。")]),s._v(" "),t("p",[t("strong",[t("code",[s._v("props")]),s._v(":")]),s._v("  和"),t("code",[s._v("attributes")]),s._v("模块类似，设置"),t("code",[s._v("DOM")]),s._v("元素的属性"),t("code",[s._v("element[attr]=value")]),s._v(",不处理布尔类型的属性。")]),s._v(" "),t("p",[t("code",[s._v("class")]),s._v(": 切换样式类，注意：给元素设置类样式是通过"),t("code",[s._v("sel")]),s._v("选择器。··")]),s._v(" "),t("p",[t("code",[s._v("dataset")]),s._v(":设置"),t("code",[s._v("HTML5")]),s._v(" 中的 "),t("code",[s._v("data-*")]),s._v(" 的自定义属性")]),s._v(" "),t("p",[t("code",[s._v("eventlisteners")]),s._v(": 注册和移除事件")]),s._v(" "),t("p",[t("code",[s._v("style")]),s._v(":设置行内样式，支持动画（内部创建"),t("code",[s._v("transitionend")]),s._v("事件）,会增加额外的属性：delayed / remove / destroy")]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用snabbdom提供修改dom各种属性的模块")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'snabbdom'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 样式模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" styleModule "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'snabbdom/modules/style'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 事件处理模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" eventListenersModule "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'snabbdom/modules/eventlisteners'")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 注册模块")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" patch"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("init")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("styleModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("eventListenersModule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" app"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("querySelector")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#app"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" vnode"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"div#container"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("style")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("color")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'red'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("on")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token string-property property"}},[s._v("'click'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("clickHandler\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"span"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("h")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"p标签"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("app"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("vnode"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("clickHandler")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    console"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'hello world'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("h2",{attrs:{id:"_3-snabbdom的工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-snabbdom的工作原理"}},[s._v("#")]),s._v(" 3. snabbdom的工作原理")]),s._v(" "),t("p",[t("strong",[s._v("h函数")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("输入：")]),s._v(" "),t("ul",[t("li",[s._v("选择器")]),s._v(" "),t("li",[s._v("属性配置，样式配置，事件等配置")]),s._v(" "),t("li",[s._v("子节点")])])]),s._v(" "),t("li",[t("p",[s._v("输出：vNode")]),s._v(" "),t("ul",[t("li",[s._v("vNode.sel 选择器")]),s._v(" "),t("li",[s._v("children 子节点数组")]),s._v(" "),t("li",[s._v("text:子节点为文本节点内容")]),s._v(" "),t("li",[s._v("key 唯一标识")]),s._v(" "),t("li",[s._v("elm dom元素")])])]),s._v(" "),t("li",[t("p",[s._v("工作流程")]),s._v(" "),t("ul",[t("li",[s._v("对输入进行判断，参数2，3是可选的，根据不同的参数输出不同的vNode,对于输入的子节点数组，都转换为vNode类型")])])])]),s._v(" "),t("p",[t("strong",[s._v("init函数")])]),s._v(" "),t("ul",[t("li",[s._v("输入\n"),t("ul",[t("li",[s._v("模块配置数组")]),s._v(" "),t("li",[s._v("DOMApi")])])]),s._v(" "),t("li",[s._v("输出\n"),t("ul",[t("li",[s._v("patch函数")])])]),s._v(" "),t("li",[s._v("作用\n"),t("ul",[t("li",[s._v("根据输入的模块配置数组，读取模块数组中每个模块的生命周期函数，用于在patch函数执行时机执行")])])])]),s._v(" "),t("p",[t("strong",[s._v("patch函数")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("输入")]),s._v(" "),t("ul",[t("li",[s._v("旧vNode|Dom元素")]),s._v(" "),t("li",[s._v("新vNode")])])]),s._v(" "),t("li",[t("p",[s._v("输出")]),s._v(" "),t("ul",[t("li",[s._v("新vNode")])])]),s._v(" "),t("li",[t("p",[s._v("工作流程")]),s._v(" "),t("ul",[t("li",[s._v("把参数1转换为vNode,如果参数1不是vNode")]),s._v(" "),t("li",[s._v("比较vNode1和vNode2是否相同，模糊比较：sel和key比较\n"),t("ul",[t("li",[s._v("相同\n"),t("ul",[t("li",[s._v("子节点递归")])])]),s._v(" "),t("li",[s._v("不同\n"),t("ul",[t("li",[s._v("找到父亲")]),s._v(" "),t("li",[s._v("根据新vNode生成dom元素")]),s._v(" "),t("li",[s._v("老vNode.elm的后面")]),s._v(" "),t("li",[s._v("删除老vNode.elm")])])])])])])])]),s._v(" "),t("p",[t("strong",[s._v("createElm")])]),s._v(" "),t("p",[t("strong",[s._v("输入")])]),s._v(" "),t("ul",[t("li",[s._v("vnode")])]),s._v(" "),t("p",[t("strong",[s._v("输出")])]),s._v(" "),t("ul",[t("li",[s._v("dom元素")])]),s._v(" "),t("p",[t("strong",[s._v("工作流程")])]),s._v(" "),t("ul",[t("li",[t("p",[s._v("处理vNode的data数据(样式，属性等数据，执行样式，属性模块的回调函数处理)")])]),s._v(" "),t("li",[t("p",[s._v("虚拟节点转换为对应的dom元素")]),s._v(" "),t("ul",[t("li",[s._v("对vNode.sel 处理，分离出各类选择器")]),s._v(" "),t("li",[s._v("创建一个元素，根据上一步添加class，id等属性")]),s._v(" "),t("li",[s._v("子节点递归上述操作")])])])]),s._v(" "),t("p",[t("strong",[s._v("patchVnode")])]),s._v(" "),t("ul",[t("li",[s._v("两个vNode进行sel和key比较相同时，调用")])]),s._v(" "),t("p",[t("img",{attrs:{src:"https://img2023.cnblogs.com/blog/3089561/202303/3089561-20230314200740259-1310789053.png",alt:""}})]),s._v(" "),t("p",[t("strong",[s._v("updateChildren")])]),s._v(" "),t("ul",[t("li",[s._v("新旧节点都有子节点，进行子节点的更新,diff算法")])]),s._v(" "),t("h3",{attrs:{id:"_4-diff算法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-diff算法"}},[s._v("#")]),s._v(" 4. diff算法")]),s._v(" "),t("ul",[t("li",[s._v("新旧节点，vNode表示树形化，存储的时候是数组")]),s._v(" "),t("li",[s._v("oldVnode：startIndex,endIndex")]),s._v(" "),t("li",[s._v("newVnode：startIndex,endIndex")]),s._v(" "),t("li",[s._v("四种比较情况\n"),t("ul",[t("li",[s._v("oldVnode.startIndex：newVnode.startIndex")]),s._v(" "),t("li",[s._v("oldVnode.startIndex：newVnode.endIndex")]),s._v(" "),t("li",[s._v("oldVnode.endIndex：newVnode.startIndex")]),s._v(" "),t("li",[s._v("oldVnode.endIndex：newVnode.endIndex")])])])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 旧节点startIndex与新节点的startIndex相同(sameVnodes比较),patchVnodes")]),s._v("\n\t新节点startIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n\t旧节点startIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不同的情况")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 旧节点的endIndex与新节点的endIndex比较(sameVnodes比较),patchVnodes")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 相同 ")]),s._v("\n\t\t\t新节点endIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n\t\t\t旧节点endIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 不同")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 旧节点的startIndex 与 新节点的endIndex比较(sameVnodes比较)")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 相同 patchVnodes,然后放到oldend序列的最后")]),s._v("\n\t\t\t旧节点startIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n\t\t\t新节点endIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 旧节点endIndex 与 新节点startIndex 比较((sameVnodes比较))")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 相同，\tpatchVnodes,然后放到oldstart序列的最前面")]),s._v("\n\t\t\t旧节点endIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n\t\t\t新节点startIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("p",[t("strong",[s._v("上述条件都不满足")])]),s._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// newStartIndex 不变")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 在oldVnodes数组中查找到与newStartIndex相同的")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 没有找到：直接创建一个全新节点，插入到oldStartIndex节点的前面")]),s._v("\n\t\tnewStartIndex"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 找到了：patchVnodes(old,new),然后放在oldStartIndex的前面")]),s._v("\n\t\t\n\t\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);